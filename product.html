<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">

  <div id="product-container" class="max-w-5xl mx-auto p-6"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const productId = params.get("id");

    if (!productId) {
      document.getElementById("product-container").innerHTML = "<p>Product not found.</p>";
    } else {
      fetch(`https://8cac9444864f.ngrok-free.app/api/products/${productId}?populate=*`, {
        headers: { 'ngrok-skip-browser-warning': 'true' }
      })
      .then(res => res.json())
      .then(data => {
        const product = data.data.attributes;
        const imageUrl = product.image?.data?.attributes?.url
          ? `https://8cac9444864f.ngrok-free.app${product.image.data.attributes.url}`
          : "https://via.placeholder.com/600x400?text=No+Image";

        document.getElementById("product-container").innerHTML = `
          <div class="grid md:grid-cols-2 gap-6">
            <img src="${imageUrl}" alt="${product.name}" class="w-full rounded-lg shadow" />
            <div>
              <h1 class="text-3xl font-bold mb-4">${product.name}</h1>
              <p class="text-gray-600 dark:text-gray-300 mb-4">${product.description}</p>
              <p class="text-2xl font-semibold mb-6">$${product.price.toFixed(2)}</p>
              <button
                onclick="addToCart(${productId}, '${product.name.replace(/'/g, "\\'")}', ${product.price})"
                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md transition"
              >
                Add to Cart
              </button>
            </div>
          </div>
        `;
      })
      .catch(err => console.error("Error fetching product:", err));
    }

    // Cart logic (localStorage-based)
    function addToCart(id, name, price) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existing = cart.find(item => item.id === id);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ id, name, price, quantity: 1 });
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`${name} added to cart!`);
    }
  </script>

</body>
</html>
